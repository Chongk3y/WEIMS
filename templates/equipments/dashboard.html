{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% load static %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container-fluid py-3 px-3">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-semibold mb-0">Dashboard</h4>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3">
    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body p-2">
          <small class="text-muted">Total</small>
          <h5 class="fw-bold">{{ total_equipments }}</h5>
        </div>
      </div>
    </div>

    {% for status in status_counts %}
    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 text-center">
        <div class="card-body p-2">
          <small class="text-muted">{{ status.name }}</small>
          <h6 class="fw-bold text-dark">{{ status.count }}</h6>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Charts and Recent -->
  <div class="row mt-4 g-3">
    <!-- Recent -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-header py-2 bg-light">
          <small class="fw-semibold">ðŸ•’ Recent Equipments</small>
        </div>
        <div class="card-body p-2">
          {% if recent_equipments %}
          <ul class="list-group list-group-flush small">
            {% for eq in recent_equipments %}
            <li class="list-group-item d-flex justify-content-between align-items-start px-2 py-1">
              <div>
                <strong>{{ eq.item_name }}</strong><br>
                <small class="text-muted">{{ eq.item_propertynum }} â€¢ {{ eq.item_purdate }}</small>
              </div>
              <span class="badge bg-secondary">{{ eq.category.name }}</span>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted small">No recent items.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0">
        <div class="card-header py-2 bg-light">
          <small class="fw-semibold">ðŸ“‚ By Category</small>
        </div>
        <div class="card-body p-2">
          <canvas id="categoryChart" height="140"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart Script -->
<script>
  const ctx = document.getElementById('categoryChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ category_labels|safe }},
      datasets: [{
        label: 'Equipments',
        data: {{ category_counts|safe }},
        backgroundColor: '#0e4a39',
        borderRadius: 5
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });
</script>
{% endblock %}
